<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 Model selection, tree reconstruction and support evaluation | Phylogenomics</title>
  <meta name="description" content="NEOF book for the Phylogenomics workshop" />
  <meta name="generator" content="bookdown 0.36 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 Model selection, tree reconstruction and support evaluation | Phylogenomics" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="/figures/NEOF.png" />
  <meta property="og:description" content="NEOF book for the Phylogenomics workshop" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 Model selection, tree reconstruction and support evaluation | Phylogenomics" />
  
  <meta name="twitter:description" content="NEOF book for the Phylogenomics workshop" />
  <meta name="twitter:image" content="/figures/NEOF.png" />

<meta name="author" content="Gavin Gouws, Matthew Gemmell, Helen Hipperson, Ewan Harney, Kathryn Maher" />


<meta name="date" content="2024-01-22" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="figures/NEOF_favicon.png" type="image/x-icon" />
<link rel="prev" href="05_Preparing_data_with_Stacks.html"/>
<link rel="next" href="07-Topology_testing.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
<link rel="stylesheet" href="www/webex.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="toc-logo"><a href="https://neof.org.uk/" target="blank"><img src="figures/NEOF_bordered_small.png"></a></li>
<li><a>Phylogenomics</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="01-Intro.html"><a href="01-Intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="02-Background.html"><a href="02-Background.html"><i class="fa fa-check"></i><b>2</b> Background</a>
<ul>
<li class="chapter" data-level="2.1" data-path="02-Background.html"><a href="02-Background.html#example-data-ddradseq-data-of-manta-and-devil-rays"><i class="fa fa-check"></i><b>2.1</b> Example data: ddRADseq data of manta and devil rays</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="03-Cluster_Introduction.html"><a href="03-Cluster_Introduction.html"><i class="fa fa-check"></i><b>3</b> Cluster Introduction</a>
<ul>
<li class="chapter" data-level="3.1" data-path="03-Cluster_Introduction.html"><a href="03-Cluster_Introduction.html#logon-instructions"><i class="fa fa-check"></i><b>3.1</b> Logon instructions</a></li>
<li class="chapter" data-level="3.2" data-path="03-Cluster_Introduction.html"><a href="03-Cluster_Introduction.html#the-terminal-window"><i class="fa fa-check"></i><b>3.2</b> The Terminal Window</a></li>
<li class="chapter" data-level="3.3" data-path="03-Cluster_Introduction.html"><a href="03-Cluster_Introduction.html#accessing-the-example-data"><i class="fa fa-check"></i><b>3.3</b> Accessing the example data</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="04-Quality_Control.html"><a href="04-Quality_Control.html"><i class="fa fa-check"></i><b>4</b> Quality Control</a>
<ul>
<li class="chapter" data-level="4.1" data-path="04-Quality_Control.html"><a href="04-Quality_Control.html#workshop-data"><i class="fa fa-check"></i><b>4.1</b> Workshop data</a></li>
<li class="chapter" data-level="4.2" data-path="04-Quality_Control.html"><a href="04-Quality_Control.html#manta--and-devil-ray-ddrad-data-set"><i class="fa fa-check"></i><b>4.2</b> Manta- and devil-ray ddRAD data set</a></li>
<li class="chapter" data-level="4.3" data-path="04-Quality_Control.html"><a href="04-Quality_Control.html#quality-assessment"><i class="fa fa-check"></i><b>4.3</b> Quality assessment</a></li>
<li class="chapter" data-level="4.4" data-path="04-Quality_Control.html"><a href="04-Quality_Control.html#quality-control"><i class="fa fa-check"></i><b>4.4</b> Quality Control</a></li>
<li class="chapter" data-level="4.5" data-path="04-Quality_Control.html"><a href="04-Quality_Control.html#post-qc-check"><i class="fa fa-check"></i><b>4.5</b> Post QC Check</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="05_Preparing_data_with_Stacks.html"><a href="05_Preparing_data_with_Stacks.html"><i class="fa fa-check"></i><b>5</b> Preparing data in Stacks</a>
<ul>
<li class="chapter" data-level="5.1" data-path="05_Preparing_data_with_Stacks.html"><a href="05_Preparing_data_with_Stacks.html#stacks-1"><i class="fa fa-check"></i><b>5.1</b> Stacks</a></li>
<li class="chapter" data-level="5.2" data-path="05_Preparing_data_with_Stacks.html"><a href="05_Preparing_data_with_Stacks.html#demultiplexing-data-with-process_radtags"><i class="fa fa-check"></i><b>5.2</b> Demultiplexing data with <code>process_radtags</code></a></li>
<li class="chapter" data-level="5.3" data-path="05_Preparing_data_with_Stacks.html"><a href="05_Preparing_data_with_Stacks.html#building-the-catalogue-loci-with-denovo_map.pl"><i class="fa fa-check"></i><b>5.3</b> Building the catalogue loci with <code>denovo_map.pl</code></a></li>
<li class="chapter" data-level="5.4" data-path="05_Preparing_data_with_Stacks.html"><a href="05_Preparing_data_with_Stacks.html#preparing-a-sequence-alignment-file-in-populations"><i class="fa fa-check"></i><b>5.4</b> Preparing a sequence alignment file in <code>populations</code></a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="06-Phylogeny.html"><a href="06-Phylogeny.html"><i class="fa fa-check"></i><b>6</b> Model selection, tree reconstruction and support evaluation</a>
<ul>
<li class="chapter" data-level="6.1" data-path="06-Phylogeny.html"><a href="06-Phylogeny.html#estimating-a-best-fit-model-of-nucleotide-or-sequence-evolution"><i class="fa fa-check"></i><b>6.1</b> Estimating a best-fit model of nucleotide or sequence evolution</a></li>
<li class="chapter" data-level="6.2" data-path="06-Phylogeny.html"><a href="06-Phylogeny.html#constructing-a-maximum-likelihood-phylogenetic-tree"><i class="fa fa-check"></i><b>6.2</b> Constructing a maximum-likelihood phylogenetic tree</a></li>
<li class="chapter" data-level="6.3" data-path="06-Phylogeny.html"><a href="06-Phylogeny.html#calculating-nodal-support"><i class="fa fa-check"></i><b>6.3</b> Calculating nodal support</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="07-Topology_testing.html"><a href="07-Topology_testing.html"><i class="fa fa-check"></i><b>7</b> Hypothesis and topology testing</a></li>
<li class="chapter" data-level="8" data-path="08-Dating_phylogenies.html"><a href="08-Dating_phylogenies.html"><i class="fa fa-check"></i><b>8</b> Dating phylogenies</a>
<ul>
<li class="chapter" data-level="8.1" data-path="08-Dating_phylogenies.html"><a href="08-Dating_phylogenies.html#setting-up-the-date-file"><i class="fa fa-check"></i><b>8.1</b> Setting up the date file</a></li>
<li class="chapter" data-level="8.2" data-path="08-Dating_phylogenies.html"><a href="08-Dating_phylogenies.html#running-the-analysis"><i class="fa fa-check"></i><b>8.2</b> Running the analysis</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="08-Dating_phylogenies.html"><a href="08-Dating_phylogenies.html#dating-our-tree"><i class="fa fa-check"></i><b>8.2.1</b> Dating our tree</a></li>
<li class="chapter" data-level="8.2.2" data-path="08-Dating_phylogenies.html"><a href="08-Dating_phylogenies.html#getting-confidence-intervals-around-our-dates"><i class="fa fa-check"></i><b>8.2.2</b> Getting confidence intervals around our dates</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="09-Delimiting_species.html"><a href="09-Delimiting_species.html"><i class="fa fa-check"></i><b>9</b> Species delimitation with the Multispecies Coalescent</a>
<ul>
<li class="chapter" data-level="9.1" data-path="09-Delimiting_species.html"><a href="09-Delimiting_species.html#beast2"><i class="fa fa-check"></i><b>9.1</b> beast2</a></li>
<li class="chapter" data-level="9.2" data-path="09-Delimiting_species.html"><a href="09-Delimiting_species.html#gene-tree---species-tree-conflicts"><i class="fa fa-check"></i><b>9.2</b> Gene tree - species tree conflicts</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="09-Delimiting_species.html"><a href="09-Delimiting_species.html#setting-up-the-analysis"><i class="fa fa-check"></i><b>9.2.1</b> Setting up the analysis</a></li>
<li class="chapter" data-level="9.2.2" data-path="09-Delimiting_species.html"><a href="09-Delimiting_species.html#starting-the-analysis"><i class="fa fa-check"></i><b>9.2.2</b> Starting the analysis</a></li>
<li class="chapter" data-level="9.2.3" data-path="09-Delimiting_species.html"><a href="09-Delimiting_species.html#examining-the-results"><i class="fa fa-check"></i><b>9.2.3</b> Examining the results</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="09-Delimiting_species.html"><a href="09-Delimiting_species.html#bayes-factor-delimitation"><i class="fa fa-check"></i><b>9.3</b> Bayes Factor Delimitation</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="09-Delimiting_species.html"><a href="09-Delimiting_species.html#setting-up-the-analysis-1"><i class="fa fa-check"></i><b>9.3.1</b> Setting up the analysis</a></li>
<li class="chapter" data-level="9.3.2" data-path="09-Delimiting_species.html"><a href="09-Delimiting_species.html#running-the-analysis-1"><i class="fa fa-check"></i><b>9.3.2</b> Running the analysis</a></li>
<li class="chapter" data-level="9.3.3" data-path="09-Delimiting_species.html"><a href="09-Delimiting_species.html#selecting-the-taxonomic-hypothesis"><i class="fa fa-check"></i><b>9.3.3</b> Selecting the taxonomic hypothesis</a></li>
</ul></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="10-Appendix.html"><a href="10-Appendix.html"><i class="fa fa-check"></i><b>A</b> Mamba installs</a>
<ul>
<li class="chapter" data-level="A.1" data-path="10-Appendix.html"><a href="10-Appendix.html#mamba_install"><i class="fa fa-check"></i><b>A.1</b> Mamba installation and environment</a></li>
</ul></li>
<li class="chapter" data-level="B" data-path="10-Appendix.html"><a href="10-Appendix.html#loops"><i class="fa fa-check"></i><b>B</b> Wildcards and loops</a>
<ul>
<li class="chapter" data-level="B.1" data-path="10-Appendix.html"><a href="10-Appendix.html#a-simple-wildcard"><i class="fa fa-check"></i><b>B.1</b> A simple wildcard</a></li>
<li class="chapter" data-level="B.2" data-path="10-Appendix.html"><a href="10-Appendix.html#loops-1"><i class="fa fa-check"></i><b>B.2</b> Loops</a>
<ul>
<li class="chapter" data-level="B.2.1" data-path="10-Appendix.html"><a href="10-Appendix.html#an-example-of-a-simple-loop"><i class="fa fa-check"></i><b>B.2.1</b> An example of a simple loop</a></li>
<li class="chapter" data-level="B.2.2" data-path="10-Appendix.html"><a href="10-Appendix.html#stacks-process_radtags-loop-example"><i class="fa fa-check"></i><b>B.2.2</b> Stacks <code>process_radtags</code> loop example</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="C" data-path="10-Appendix.html"><a href="10-Appendix.html#optimising-loci-reconstruction-in-denovo_map.pl-in-stacks"><i class="fa fa-check"></i><b>C</b> Optimising loci reconstruction in <code>denovo_map.pl</code> in Stacks</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Phylogenomics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="phylogeny" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">Chapter 6</span> Model selection, tree reconstruction and support evaluation<a href="06-Phylogeny.html#phylogeny" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p><img src="figures/iqtree_icon.png" width="50%" style="display: block; margin: auto;" /></p>
<p>We will use <a href="http://www.iqtree.org">IQ-TREE</a> to construct and evaluate a phylogenetic tree. IQ-TREE is a popular package that uses a very fast and efficient algorithm to infer phylogenomic trees under a maximum-likelihood framework. It also incorporates modules for evaluating and selecting models prior to tree reconstruction, and for bootstrapping to determine nodal support. These modules, <a href="https://www.nature.com/articles/nmeth.4285">ModelFinder</a>, for evaluating models, and <a href="https://academic.oup.com/mbe/article/35/2/518/4565479?login=true">UFBoot</a> for evaluating support, are substantially faster than many alternative, stand-alone packages, such as <a href="https://academic.oup.com/mbe/article/30/5/1188/997508?login=true">jModelTest</a> or the bootstrapping procedure that is used in <a href="https://github.com/stamatak/standard-RAxML">RAxML</a>, another popular and widely-used, likelihood-based, phylogenetic-reconstruction package. The latest version, <a href="https://academic.oup.com/mbe/article/37/5/1530/5721363?login=true">IQTREE-2</a>, can be installed in Linux, Windows and Mac systems, and offers a range of new tree-search options and sequence evolution models. There is also a IQ-TREE <a href="http://iqtree.cibiv.univie.ac.at/">web-server</a> to which jobs can be submitted.</p>
<p>Navigate to the 'iqtree' directory:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode bash Rchunk"><code class="sourceCode bash"><span id="cb31-1"><a href="06-Phylogeny.html#cb31-1" tabindex="-1"></a><span class="bu">cd</span> ~/phylogenomics/iqtree</span></code></pre></div>
<p>We will produce a phylogenetic tree of ten species of manta- and devil-rays, including two representatives of each of eight <em>Mobula</em> species and two former <em>Manta</em> species, and two <em>Rhinoptera bonasus</em> individuals as outgroup representatives. The data were produced exactly as in the previous chapter, following the second approach in which we maximised the number of SNP loci included. We are deliberately including a sparse data set (which many deeper phylogenetic data sets are likely to be) in order to potentially introduce uncertainty into our reconstruction and support evaluation.</p>
<p>If we were to use the first approach and eliminate all missing data, we would have been left with only 307 characters to analyse, opposed to 1 678 from the previous exercise! This demonstrates quite nicely how the number of RAD loci and SNPs that are common to all samples in the Stacks catalogue decreases and missing data increase when one adds more distantly-related species to a dataset. In this case, we have added more species, representatives of species that previously belonged to another genus, <em>Manta</em>, and a more distantly-related outgroup.</p>
<p>Take a look at the 'popmap' used to generate this data set to get a feel for the individuals and taxa included.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode bash Rchunk"><code class="sourceCode bash"><span id="cb32-1"><a href="06-Phylogeny.html#cb32-1" tabindex="-1"></a><span class="fu">less</span> phylogeny.popmap</span></code></pre></div>
<p>Check that you have the Phylip file ('manta_phylogeny.phylip') that we will use for the analysis.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode bash Rchunk"><code class="sourceCode bash"><span id="cb33-1"><a href="06-Phylogeny.html#cb33-1" tabindex="-1"></a><span class="fu">ls</span> <span class="at">-l</span></span></code></pre></div>
<p>You can take a look at the header of this file to see the dimensions (taxa X characters) of the matrix.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode bash Rchunk"><code class="sourceCode bash"><span id="cb34-1"><a href="06-Phylogeny.html#cb34-1" tabindex="-1"></a><span class="fu">head</span> <span class="at">-n</span> 1 manta_phylogeny.phylip</span></code></pre></div>
<p>We will now work through the various steps of tree construction. Although many of the steps can be combined in a single command and IQ-TREE analysis, we will estimate a best-fit model of nucleotide-evolution, construct a phylogenetic tree and evaluate bootstrap support separately in order to pause and consider the procedure and results.</p>
<div id="estimating-a-best-fit-model-of-nucleotide-or-sequence-evolution" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> Estimating a best-fit model of nucleotide or sequence evolution<a href="06-Phylogeny.html#estimating-a-best-fit-model-of-nucleotide-or-sequence-evolution" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<blockquote>
<p>"All models are wrong, but some are useful"</p>
<p>--- George E. P. Box</p>
</blockquote>
<p><img src="figures/model.png" width="50%" style="display: block; margin: auto;" /></p>
<p>IQ-TREE supports and tests the fit of well over 100 variations of models of sequence evolution, including traditional rate-matrix (base substitution) base frequency models and newer Lie Markov models. It can also accommodate advanced partition models and mixture models, should these be needed for your data.</p>
<p>To evaluate and choose a model, we will use this code:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode bash Rchunk"><code class="sourceCode bash"><span id="cb35-1"><a href="06-Phylogeny.html#cb35-1" tabindex="-1"></a><span class="ex">iqtree</span> <span class="at">-s</span> manta_phylogeny.phylip <span class="at">-m</span> MFP</span></code></pre></div>
<p>In this,
- <code>-s</code> denotes our data input file. IQ-TREE can support sequence alignments in PHYLIP, fasta, NEXUS and a number of other formats.
- <code>-m</code> indicates that we wish to use ModelFinder (<code>MFP</code>) to find the most appropriate model.</p>
<p>This analysis should take about two minutes to run and will log useful output to the terminal. This will also be saved as a log file ('manta_phylogeny.log'). For each of the evaluated models, it reports the log-likelihood (-lnL; the likelihood of observing the data given this particular model and the topology of a preliminary tree constructed using parsimony), and the Akaike Information Criterion (AIC), the corrected Akaike Information Criterion (AICc) and Bayesian Information Criterion (BIC) scores used in comparing the models. Our choice is based on the BIC, with the model minimising the BIC favoured. You can set this if you want to use one of the other criteria. Once IQ-TREE has identified the optimal model, it will generate a number of of candidate trees to fit, and then estimate and optimise the parameters of our chosen model, which is the final output in the terminal.</p>
<p>Open the log-file and scroll through the output:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode bash Rchunk"><code class="sourceCode bash"><span id="cb36-1"><a href="06-Phylogeny.html#cb36-1" tabindex="-1"></a><span class="fu">less</span> manta_phylogeny.phylip.log</span></code></pre></div>
<ol style="list-style-type: decimal">
<li>Which is the optimal model for this data set, as selected by the BIC?
<div id="radio_FKYVCDIXTQ" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_FKYVCDIXTQ" value="answer"></input> <span>K2P+ASC</span></label><label><input type="radio" autocomplete="off" name="radio_FKYVCDIXTQ" value=""></input> <span>TVM+F+ASC</span></label>
</div></li>
</ol>
<p>An overview of the various models of sequence or nucleotide evolution can be found <a href="https://en.wikipedia.org/wiki/Models_of_DNA_evolution">here</a>. At the base are a number of simple or straight-forward models (with very few parameters), but these are made increasingly more complex as more parameters are allowed to vary or are added. Older software packages only implemented simpler models, but with increasing computing power, we can now make the models a lot more complicated and specific. This is often needed for our larger and more complex data sets.</p>
<p>The model chosen here is a simple two-parameter model. The base frequencies are all equal (at 0.25), and we have differing substitution rates (1.000 and 5.574) for transitions and transversions. In this instance, a correction for ascertainment bias (the '+ASC') has also been included. SNP data (like morphological data) are biased in that we only include variable data and have no constant sites or characters in our data sets. This needs to be considered when calculating and evaluating tree statistics and branch lengths.</p>
</div>
<div id="constructing-a-maximum-likelihood-phylogenetic-tree" class="section level2 hasAnchor" number="6.2">
<h2><span class="header-section-number">6.2</span> Constructing a maximum-likelihood phylogenetic tree<a href="06-Phylogeny.html#constructing-a-maximum-likelihood-phylogenetic-tree" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><img src="figures/sapling.png" width="50%" style="display: block; margin: auto;" /></p>
<p>We will now construct a maximum-likelihood phylogenetic tree, implementing the chosen model and the parameters we have estimated.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode bash Rchunk"><code class="sourceCode bash"><span id="cb37-1"><a href="06-Phylogeny.html#cb37-1" tabindex="-1"></a><span class="ex">iqtree</span> <span class="at">-s</span> manta_phylogeny.phylip <span class="at">-m</span> K2P+ASC <span class="at">-o</span> Rhinoptera_bonasus1 <span class="at">-redo</span></span></code></pre></div>
<p>In this command,
- <code>-s</code> again refers to the input data file.
- <code>-m</code> invokes the model we want to use. We can specify <code>MFP</code> if we want to search for a model and construct the tree in one command. We have already performed this step, so here we will just specify the model that was selected above (<code>K2P+ASC</code>).
- <code>-o</code>: We use this to specify our outgroup, ' <em>Rhinoptera_bonasus1</em> ' in this case. If you do not specify an outgroup, IQ-TREE will regard the tree as unrooted, but will use the first taxon/entry in your alignment to root it for display purposes.
- <code>-redo</code>: This is a neat safety feature built into IQ-TREE to prevent you accidentally overwriting previous work. If you have run analyses on a particular data file and generated log and output files before and you execute a command without <code>-redo</code>, it will issue an error warning and not execute. You are welcome to try the above command without <code>-redo</code> to see what happens.</p>
<p>The report and output of the analysis will be written to the output file 'manta_phylogeny.phylip.iqtree'. You can open this to see the summary of the data and the parameters that were used, the tree statistics (likelihood score and length) and the tree itself. You may need to resize your terminal window or it might spread each branch of the tree over multiple lines of the terminal and make it hard to interpret. If this happens, resize your window and execute the command again.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode bash Rchunk"><code class="sourceCode bash"><span id="cb38-1"><a href="06-Phylogeny.html#cb38-1" tabindex="-1"></a><span class="fu">less</span> manta_phylogeny.phylip.iqtree</span></code></pre></div>
<p>The tree is also presented in <a href="https://en.wikipedia.org/wiki/Newick_format#:~:text=In%20mathematics%2C%20Newick%20tree%20format,lengths%20using%20parentheses%20and%20commas">Newick</a> format at the bottom of the file. The parentheses (brackets) and commas indicate the relationships and branching patterns in the tree, while the numbers indicate the branch lengths, as proportional mutations along that branch to the next node or to the taxon (at the tips). Newick annotation is a widely-used format and is accepted by most phylogenetic applications that would need a tree topology as input, and there are several editors (e.g., <a href="http://tree.bio.ed.ac.uk/software/figtree/">FigTree</a>) available to manipulate tree topologies in this format, and to save the tree graphically for editing and publication. A separate Newick treefile ('manta_phylogeny.phylip.treefile') is written by IQ-TREE and can be used for this purpose.</p>
<p>A few things are apparent from this tree. As expected, the two representatives of each species group together, except for <em>Mobula japanica</em> (we'll come back to this), but those species belonging to the former genus <em>Manta</em> are nested within the genus <em>Mobula</em>. Let's examine the support for this and other relationships.</p>
</div>
<div id="calculating-nodal-support" class="section level2 hasAnchor" number="6.3">
<h2><span class="header-section-number">6.3</span> Calculating nodal support<a href="06-Phylogeny.html#calculating-nodal-support" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><img src="figures/boot.png" width="50%" style="display: block; margin: auto;" /></p>
<p>We'll use ultrafast bootstrap approximation, developed by <a href="https://academic.oup.com/mbe/article/30/5/1188/997508?login=true">Minh <em>et al.</em> (2013)</a> and implemented in UFBoot, to calculate support for our nodes and relationships in the tree. This approach is orders of magnitude faster than non-parametric (i.e., "traditional") bootstrapping, is less sensitive to model violations and produces less biased estimates of support.</p>
<p>We will execute the command as before, with one addition:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode bash Rchunk"><code class="sourceCode bash"><span id="cb39-1"><a href="06-Phylogeny.html#cb39-1" tabindex="-1"></a><span class="ex">iqtree</span> <span class="at">-s</span> manta_phylogeny.phylip <span class="at">-m</span> K2P+ASC <span class="dt">\</span></span>
<span id="cb39-2"><a href="06-Phylogeny.html#cb39-2" tabindex="-1"></a>-o Rhinoptera_bonasus1 <span class="dt">\</span></span>
<span id="cb39-3"><a href="06-Phylogeny.html#cb39-3" tabindex="-1"></a>-bb 10000 <span class="at">-redo</span></span></code></pre></div>
<p>We specify (with the <code>-bb</code>) the number of bootstrap replicates we want to perform; 1000 is recommended as a minimum. Once complete, we can open the updated 'manta_phylogeny.phylip.iqtree' file to see the resulting tree with the bootstrap support values appended.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode bash Rchunk"><code class="sourceCode bash"><span id="cb40-1"><a href="06-Phylogeny.html#cb40-1" tabindex="-1"></a><span class="fu">less</span> manta_phylogeny.phylip.iqtree</span></code></pre></div>
<p>The interpretation of ultrafast bootstrap approximation support is slightly different to that of traditional bootstrapping, and the support produced by the two methods can't really be compared. We only consider UFBoot support &gt; 95% as being meaningful, whereas non-parametric bootstrap values &gt; 75% are generally accepted as supported (because this metric underestimates support). Nevertheless, our tree shows that most of the relationships are well-supported, including the placement of the two <em>Manta</em> species within <em>Mobula</em>, but we'll test that further in the next chapter.</p>
<p>By way of comparison, the figure below indicates the slight difference in support generated by non-parametric bootstrapping. This analysis used only 100 replicates and took nearly 45 minutes on this modest data set, compared to the two minutes it took to perform 10 000 UFBoot replicates.</p>
<p><img src="figures/nonparametric_bootstrap.png" width="30%" style="display: block; margin: auto;" /></p>

</div>
</div>
<script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  console.log("webex: update total_correct");

  var t = document.getElementsByClassName("webex-total_correct");
  for (var i = 0; i < t.length; i++) {
    p = t[i].parentElement;
    var correct = p.getElementsByClassName("webex-correct").length;
    var solvemes = p.getElementsByClassName("webex-solveme").length;
    var radiogroups = p.getElementsByClassName("webex-radiogroup").length;
    var selects = p.getElementsByClassName("webex-select").length;

    t[i].innerHTML = correct + " of " + (solvemes + radiogroups + selects) + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  console.log("webex: toggle hide");

  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* check answers */
check_func = function() {
  console.log("webex: check answers");

  var cl = this.parentElement.classList;
  if (cl.contains('unchecked')) {
    cl.remove("unchecked");
    this.innerHTML = "Hide Answers";
  } else {
    cl.add("unchecked");
    this.innerHTML = "Show Answers";
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  console.log("webex: check solveme");

  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

/* function for checking select answers */
select_func = function(e) {
  console.log("webex: check select");

  var cl = this.classList

  /* add style */
  cl.remove("webex-incorrect");
  cl.remove("webex-correct");
  if (this.value == "answer") {
    cl.add("webex-correct");
  } else if (this.value != "blank") {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

/* function for checking radiogroups answers */
radiogroups_func = function(e) {
  console.log("webex: check radiogroups");

  var checked_button = document.querySelector('input[name=' + this.id + ']:checked');
  var cl = checked_button.parentElement.classList;
  var labels = checked_button.parentElement.parentElement.children;

  /* get rid of styles */
  for (i = 0; i < labels.length; i++) {
    labels[i].classList.remove("webex-incorrect");
    labels[i].classList.remove("webex-correct");
  }

  /* add style */
  if (checked_button.value == "answer") {
    cl.add("webex-correct");
  } else {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

window.onload = function() {
  console.log("webex onload");
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  var check_sections = document.getElementsByClassName("webex-check");
  console.log("check:", check_sections.length);
  for (var i = 0; i < check_sections.length; i++) {
    check_sections[i].classList.add("unchecked");

    let btn = document.createElement("button");
    btn.innerHTML = "Show Answers";
    btn.classList.add("webex-check-button");
    btn.onclick = check_func;
    check_sections[i].appendChild(btn);

    let spn = document.createElement("span");
    spn.classList.add("webex-total_correct");
    check_sections[i].appendChild(spn);
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;

    solveme[i].insertAdjacentHTML("afterend", " <span class='webex-icon'></span>")
  }

  /* set up radiogroups */
  var radiogroups = document.getElementsByClassName("webex-radiogroup");
  for (var i = 0; i < radiogroups.length; i++) {
    radiogroups[i].onchange = radiogroups_func;
  }

  /* set up selects */
  var selects = document.getElementsByClassName("webex-select");
  for (var i = 0; i < selects.length; i++) {
    selects[i].onchange = select_func;
    selects[i].insertAdjacentHTML("afterend", " <span class='webex-icon'></span>")
  }

  update_total_correct();
}

</script>
            </section>

          </div>
        </div>
      </div>
<a href="05_Preparing_data_with_Stacks.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="07-Topology_testing.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
