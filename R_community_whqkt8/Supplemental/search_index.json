[["01-R_community_supplemental.html", "R community analysis supplemental Chapter 1 Introduction Table of contents", " R community analysis supplemental Matthew R. Gemmell 2023-10-24 Chapter 1 Introduction This book contains some supplemental materials for the R community workshop. Ensure you are using the r_community mamba environment either with . usercommunity (workshop) or on your own installation (creation instructions). Table of contents Import other data types into phyloseq Plotly to create interactive html plots This work is licensed under a Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License. "],["02-Importing.html", "Chapter 2 Importing 2.1 Bracken 2.2 Plain text files", " Chapter 2 Importing Apart from QIIME2 artifact files, other file types from other programs cann be imported into a phyloseq object. 2.1 Bracken A common way to carry out shotgun metagenomics taxonomic abundance profiling is with Kraken2 and Bracken. This section will show you how to import the bracken output. 2.1.1 Bracken: setup First we need the Bracken output in the Kraken2 report output file format. We can copy over the output made during the NEOF Shotgun metagenomics workshop. Note: If you are using Bracken ensure you are using the latest version as older versions do not provide this output. mkdir bracken_r_comm cd bracken_r_comm cp /pub14/tea/nsc206/NEOF/R_community/bracken_reports/*breport2 . We can also copy over the metadata file which we will use later. cp /pub14/tea/nsc206/NEOF/R_community/bracken_reports/KW_metadata.tsv . 2.1.2 Bracken: Convert to biom Unfortunately we can't use the bracken report files. Instead we need to convert them to a single collated biom file with kraken-biom. kraken-biom *breport2 -o KW.biom Biom files are not human readable. Therefore to check the file is correct we can create a tsv (tab seperated value) file to inspect. #Create tsv file biom convert -i KW.biom -o KW.tsv --header-key taxonomy--to-tsv #inspect tsv file less KW.tsv If your file has a header starting with \"#OTU ID\" and the sample names, followed by rows of OTUs with abundance numbers it should be good. You'll also have the taxonomy lineage as the last column because we added in --header-key taxonomy. 2.1.3 Jupyter notebook Now we are ready to carry out some R analysis. Open up jupyter-notebook and create a new R notebook called \"Bracken_phyloseq_creation\". At the top of the notebook create a cell to load the libaries we'll need. #Libraries library(&quot;phyloseq&quot;) library(&quot;microbiome&quot;) Import biom into phyloseq The first step is to import the biom file. #Read in bracken biom file pseq &lt;- phyloseq::import_biom(&quot;/KW.biom&quot;) Import sample data Next we need to import the samples data. We have a tab delimited file we will read into R as a data frame. The we can assign the sample data of pseq to the data frame. As long as the row names contain the same sample names as in the biom file it should work correctly. #Read in metadata metadf &lt;- read.csv(&quot;KW_metadata.tsv&quot;, sep=&quot;\\t&quot;, check.names = FALSE, row.names=1) #Check metadf head(metadf) #Assign sample data phyloseq::sample_data(pseq &lt;- metadf) We can then summarise our phyloseq object to make sure it seems ok. #Summarize microbiome::summarize_phyloseq(pseq) Taxonomy Let's check out the taxonomy #Check taxonomy head(phyloseq::tax_table(pseq)) It looks good but we'll carry out 2 tasks. First we'll change the taxonomy headers from Rank1... to Kingdom.... We know we can do this sue to the prefix of the taxonomies (\"k__\", \"p__\"...) #Change tax column names colnames(phyloseq::tax_table(pseq)) &lt;- c(&quot;Kingdom&quot;, &quot;Phylum&quot;, &quot;Class&quot;, &quot;Order&quot;, &quot;Family&quot;, &quot;Genus&quot;, &quot;Species&quot;) head(phyloseq::tax_table(pseq)) This next step is optional. We are going to aggregate the phyloseq object from taxids to genus. Shotgun metagenomics is not always the best tool at differentiating between species so genus classifications will be more reliable. #Aggregate to species genus_pseq &lt;- microbiome::aggregate_taxa(pseq, &quot;Genus&quot;, verbose = FALSE) #Summarise microbiome::summarize_phyloseq(genus_pseq) #Check number of genera paste0(&quot;Genera: &quot;, nrwo(phyloseq::otu_table(genus_pseq))) In your own analysis you may even want to use family or order to aggregate to, or to keep using species. Know your data, look at the literature, and make an informed decision. Of course it can be useful to look at multiple levels of taxonomy. 2.2 Plain text files If you have plain text files you can read them into R and then phyloseq-ize them. The phyloseq website has a nice tutorial on how to carry this out: https://joey711.github.io/phyloseq/import-data. "],["03-Plotly.html", "Chapter 3 R plotly 3.1 Jupyter notebook 3.2 Penguin data 3.3 PNG with ggplot2 3.4 HTML with plotly 3.5 Recap", " Chapter 3 R plotly Plotly is a graphing library that allows you to create interactive charts and maps. These are in the form of html files. This works with python, R, ggplot2, and other languages. You can create plots with plotly's own library in R. However, we'll demonstrate how to plotly plots with ggplot2. You can even embed these in online books like the below chart. Try hovering over points to get more information on them. library(&quot;ggplot2&quot;) library(&quot;plotly&quot;) library(palmerpenguins) data(package = &#39;palmerpenguins&#39;) scatter_plot &lt;- ggplot(data = penguins, aes(x = flipper_length_mm, y = body_mass_g)) + geom_point(aes(color = species, shape = species), size = 2) + scale_color_manual(values = c(&quot;darkorange&quot;,&quot;darkorchid&quot;,&quot;cyan4&quot;)) ggplotly(scatter_plot) ## ## Attaching package: &#39;plotly&#39; ## The following object is masked from &#39;package:ggplot2&#39;: ## ## last_plot ## The following object is masked from &#39;package:stats&#39;: ## ## filter ## The following object is masked from &#39;package:graphics&#39;: ## ## layout Additionally, try out the other controls. 3.1 Jupyter notebook As always we'll start off by creating a new R notebook and loading in the required libraries. Create a new notebook called \"plotly_tut\", the location does not matter. The libraries required are: #Libraries library(&quot;ggplot2&quot;) library(&quot;plotly&quot;) library(&quot;IRdisplay&quot;) library(&quot;htmlwidgets&quot;) 3.2 Penguin data We are going to use the same penguin data as the first plot in this chapter. More info in the penguin data can be found on this website. First we need to load it into R as a data frame. #Read in penguin data penguin_df &lt;- read.csv(&quot;/pub14/tea/nsc206/NEOF/R_community/penguin.tsv&quot;, check.names=FALSE, stringAsFactors = TRUE, sep = &quot;\\t&quot;) #Check df head(penguin_df) 3.3 PNG with ggplot2 After having your data the next step is to create your ggplot2 object. We'll make a box plot of Species and sex of Penguin (x-axis) versus the Flipper length (y-axis). We'll facet the plot by species and use sex as the x axis. We'll save this as an object, save it as a png with ggsave(), and display it with IRdisplay::display_png(). This is what we carried out in the main book. #ggplot2 boxplot gg_boxplot &lt;- ggplot(data= penguin_df, aes(x = sex, y = flipper_length_mm, fill = sex)) + geom_boxplot() + facet_grid(.~species) #Save as png ggsave(filename = &quot;penguin_boxplot.png&quot;, plot gg_boxplot, device = &quot;png&quot;, dpi = 300, units = &quot;mm&quot;, height = 200, width = 200) #Display png IRdisplay::display_png(file = &quot;penguin_boxplot.png&quot;) 3.4 HTML with plotly Let's create that plot again but using plotly. Additionally, we save the plotly plot to an html file with htmlwidgets::saveWidget(). We can then view the plot with ` #ggplot2 boxplot gg_boxplot &lt;- ggplot(data= penguin_df, aes(x = sex, y = flipper_length_mm, fill = sex)) + geom_boxplot() + facet_grid(.~species) #Create plotly object from ggplot2 object plotly_boxplot &lt;- plotly::ggplotly(gg_boxplot) #Save plotly object as html htmlwidgets::saveWidget(widget = plotly_boxplot, file = &quot;penguin_boxplot.html&quot;, selfcontained=TRUE) #Display plotly object plotly::embed_notebook(plotly_boxplot) You can also open \"penguin_boxplot.html\" via the jupyter navigation page to view it. 3.5 Recap Plotly is a nice way to make interactive plots. These can be embedded in jupyter-notebooks or html reports made with programs like R Markdown. They are very useful to interrogate data but they will not be as useful for make static plots for visualisation. If you have the time and inclination please try making some plotly htmls with the plots you created in the main book for this course. "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
